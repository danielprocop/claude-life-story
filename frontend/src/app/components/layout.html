<div class="app-container">
  <nav class="sidebar">
    <div class="sidebar-header">
      <h1 class="logo">Diario Intelligente</h1>
    </div>
    <ul class="nav-links">
      <li>
        <a routerLink="/dashboard" routerLinkActive="active">
          <span class="nav-icon">&#9776;</span>
          <span>Dashboard</span>
        </a>
      </li>
      <li>
        <a routerLink="/write" routerLinkActive="active">
          <span class="nav-icon">&#9998;</span>
          <span>Scrivi</span>
        </a>
      </li>
      <li>
        <a routerLink="/chat" routerLinkActive="active">
          <span class="nav-icon">&#128172;</span>
          <span>Chat</span>
        </a>
      </li>
      <li>
        <a routerLink="/search" routerLinkActive="active">
          <span class="nav-icon">&#128269;</span>
          <span>Ricerca</span>
        </a>
      </li>
      <li>
        <a routerLink="/timeline" routerLinkActive="active">
          <span class="nav-icon">&#128197;</span>
          <span>Timeline</span>
        </a>
      </li>
      <li>
        <a routerLink="/story-map" routerLinkActive="active">
          <span class="nav-icon">&#127756;</span>
          <span>Story Map</span>
        </a>
      </li>
      <li>
        <a routerLink="/graph" routerLinkActive="active">
          <span class="nav-icon">&#128304;</span>
          <span>Mappa</span>
        </a>
      </li>
      <li>
        <a routerLink="/goals" routerLinkActive="active">
          <span class="nav-icon">&#127919;</span>
          <span>Obiettivi</span>
        </a>
      </li>
      <li>
        <a routerLink="/energy" routerLinkActive="active">
          <span class="nav-icon">&#9889;</span>
          <span>Energia</span>
        </a>
      </li>
      <li>
        <a routerLink="/review" routerLinkActive="active">
          <span class="nav-icon">&#128202;</span>
          <span>Review</span>
        </a>
      </li>
      <li>
        <a routerLink="/insights" routerLinkActive="active">
          <span class="nav-icon">&#128161;</span>
          <span>Insight</span>
        </a>
      </li>
      <li>
        <a routerLink="/themes" routerLinkActive="active">
          <span class="nav-icon">&#128278;</span>
          <span>Temi</span>
        </a>
      </li>
      @if (auth.canAccessAdmin()) {
        <li>
          <a routerLink="/feedback-admin" routerLinkActive="active">
            <span class="nav-icon">&#9881;</span>
            <span>Feedback</span>
          </a>
        </li>
      }
    </ul>
    <div class="sidebar-footer">
      <p class="user-label" *ngIf="auth.user() as user">{{ user.email }}</p>
      <button class="sign-out" type="button" (click)="signOut()">Esci</button>
    </div>
  </nav>

  <div class="main-shell">
    <header class="mobile-topbar">
      <div class="brand">
        <strong>Diario</strong>
        <span *ngIf="auth.user() as user">{{ user.email }}</span>
      </div>
      <button type="button" class="mobile-sign-out" (click)="signOut()">Esci</button>
    </header>

    @if ((install.canInstall() || install.showIosHint()) && !install.dismissed() && !install.installed()) {
      <section class="install-banner">
        <div class="banner-copy">
          <strong>Installa sul telefono</strong>
          @if (install.canInstall()) {
            <p>Usa la versione app installabile per accesso rapido da home screen.</p>
          } @else {
            <p>Su iPhone: Condividi -> Aggiungi a schermata Home.</p>
          }
        </div>
        <div class="banner-actions">
          @if (install.canInstall()) {
            <button type="button" class="install-btn" (click)="installApp()">Installa</button>
          }
          <button type="button" class="dismiss-btn" (click)="dismissInstallPrompt()">Nascondi</button>
        </div>
      </section>
    }

    <main class="content">
      <router-outlet />
    </main>

    <nav class="mobile-bottom-nav">
      <a routerLink="/dashboard" routerLinkActive="active">Dashboard</a>
      <a routerLink="/write" routerLinkActive="active">Scrivi</a>
      <a routerLink="/chat" routerLinkActive="active">Chat</a>
      <a routerLink="/search" routerLinkActive="active">Ricerca</a>
      <a routerLink="/story-map" routerLinkActive="active">Story</a>
      @if (auth.canAccessAdmin()) {
        <a routerLink="/feedback-admin" routerLinkActive="active">Feedback</a>
      }
    </nav>
  </div>
</div>
