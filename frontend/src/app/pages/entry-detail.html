<section class="entry-detail-page">
  <a class="back-link" routerLink="/timeline">← Torna alla timeline</a>

  @if (loading()) {
    <div class="state-card">Caricamento entry...</div>
  } @else if (error()) {
    <div class="state-card error">{{ error() }}</div>
  } @else if (entry(); as e) {
    <article class="entry-card">
      <header class="entry-header">
        <p class="entry-date">{{ e.createdAt | date:'dd MMM yyyy, HH:mm' }}</p>
        @if (e.updatedAt) {
          <p class="entry-updated">Aggiornata {{ e.updatedAt | date:'dd MMM yyyy, HH:mm' }}</p>
        }
      </header>

      <div class="entry-content">{{ e.content }}</div>

      @if (e.concepts?.length) {
        <section class="concepts-section">
          <h3>Concetti estratti</h3>
          <div class="concept-grid">
            @for (concept of e.concepts!; track concept.id) {
              <div class="concept-pill">
                <span class="concept-type">{{ concept.type }}</span>
                <strong>{{ concept.label }}</strong>
              </div>
            }
          </div>
        </section>
      }

      @if (relatedEntries().length > 0) {
        <section class="related-section">
          <h3>Entry correlate</h3>
          <div class="related-list">
            @for (related of relatedEntries(); track related.id) {
              <article class="related-card">
                <p class="related-meta">
                  {{ related.createdAt | date:'dd MMM yyyy, HH:mm' }} · {{ related.sharedConceptCount }} concetti in comune
                </p>
                <p class="related-preview">{{ related.contentPreview }}</p>
                <a [routerLink]="['/entries', related.id]">Apri entry correlata</a>
              </article>
            }
          </div>
        </section>
      }
    </article>
  }
</section>
